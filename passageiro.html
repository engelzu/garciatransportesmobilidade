<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GARCIA MOBILIDADE - Passageiro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Substitua YOUR_GOOGLE_MAPS_API_KEY pela sua chave de API do Google Maps -->
     <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADSCUHjzyFUwjfcui_lk6vDSQ3PU0bu7g&libraries=places"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #111827; color: white; }
        .screen { display: none; }
        .screen.active { display: block; }
        .loader { border: 4px solid #4b5563; border-radius: 50%; border-top: 4px solid #6d28d9; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Toast Notifications */
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 1000; }
        .toast { background: #1f2937; border-left: 4px solid; color: white; padding: 16px; border-radius: 8px; margin-bottom: 10px; min-width: 300px; box-shadow: 0 4px 12px rgba(0,0,0,0.5); transform: translateX(400px); transition: all 0.3s ease; }
        .toast.show { transform: translateX(0); }
        .toast.success { border-left-color: #22c55e; }
        .toast.error { border-left-color: #ef4444; }
        .toast.info { border-left-color: #3b82f6; }
        .toast.warning { border-left-color: #f59e0b; }

        /* Loading Button */
        .btn-loading { position: relative; color: transparent !important; cursor: not-allowed; }
        .btn-loading::after { content: ''; position: absolute; top: 50%; left: 50%; width: 20px; height: 20px; margin: -10px 0 0 -10px; border: 2px solid #ffffff; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; }

        /* Ride Status Timeline */
        .timeline-item { display: flex; align-items: center; gap: 0.75rem; opacity: 0.5; }
        .timeline-item.active { opacity: 1; font-weight: 600; }
        .timeline-item.completed { opacity: 1; }
        .timeline-icon { font-size: 1.5rem; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">
    
    <!-- API KEY WARNING -->
    <div id="api-key-warning" class="fixed top-0 left-0 right-0 bg-red-800 p-3 text-center z-[2000] text-sm">
        <strong>ATEN√á√ÉO DESENVOLVEDOR:</strong> Voc√™ precisa substituir 'YOUR_GOOGLE_MAPS_API_KEY' pela sua chave de API do Google Maps no arquivo <strong>passageiro.html</strong> para que o mapa e os endere√ßos funcionem.
        <button onclick="this.parentElement.remove()" class="ml-4 font-bold">FECHAR</button>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <div class="w-full max-w-md mx-auto p-4">
        
        <div id="loading-screen" class="screen active text-center">
            <div class="loader mx-auto"></div>
            <p class="mt-4 text-gray-400">Carregando...</p>
            <div id="loading-error" class="hidden mt-6 bg-red-900/50 border border-red-700 p-4 rounded-lg">
                <p class="text-red-300">Parece que algo deu errado...</p>
                <p class="text-sm text-gray-400 mt-2">Por favor, verifique sua conex√£o e tente recarregar.</p>
                <button onclick="forceReload()" class="mt-4 py-2 px-4 font-semibold rounded-lg bg-indigo-600 hover:bg-indigo-700">Recarregar</button>
            </div>
        </div>

        <div id="login-screen" class="screen space-y-6 bg-gray-800 p-8 rounded-xl shadow-lg">
            <img src="images/logogarcia.png" alt="Logo Garcia Transportes" class="mx-auto h-16 w-auto">
            <h2 class="text-2xl font-bold text-center">√Årea do Passageiro</h2>
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="login-email" class="block mb-2 text-sm font-medium text-gray-300">E-mail</label>
                    <input type="email" id="login-email" class="w-full p-3 text-white rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:border-indigo-500" required>
                </div>
                <div>
                    <label for="login-password" class="block mb-2 text-sm font-medium text-gray-300">Senha</label>
                    <input type="password" id="login-password" class="w-full p-3 text-white rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:border-indigo-500" required>
                </div>
                <button type="submit" id="login-btn" class="w-full py-3 font-semibold rounded-lg bg-indigo-600 hover:bg-indigo-700 transition-colors">ENTRAR</button>
            </form>
            <p class="text-center text-sm text-gray-400">N√£o tem conta? <a href="#" onclick="showScreen('signup-screen')" class="font-semibold text-indigo-400 hover:text-indigo-300">Crie uma agora</a></p>
        </div>

        <div id="signup-screen" class="screen space-y-4 bg-gray-800 p-8 rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold text-center">Criar Conta</h2>
            <form id="signup-form" class="space-y-3">
                <input type="text" id="signup-fullname" placeholder="Nome Completo" class="w-full p-3 text-white rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:border-indigo-500" required>
                <input type="email" id="signup-email" placeholder="E-mail" class="w-full p-3 text-white rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:border-indigo-500" required>
                <input type="tel" id="signup-phone" placeholder="Telefone (11) 99999-9999" class="w-full p-3 text-white rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:border-indigo-500" required>
                <input type="password" id="signup-password" placeholder="Senha (m√≠n. 6 caracteres)" class="w-full p-3 text-white rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:border-indigo-500" required>
                <button type="submit" id="signup-btn" class="w-full py-3 font-semibold rounded-lg bg-indigo-600 hover:bg-indigo-700 transition-colors">CADASTRAR</button>
            </form>
            <p class="text-center text-sm text-gray-400">J√° tem uma conta? <a href="#" onclick="showScreen('login-screen')" class="font-semibold text-indigo-400 hover:text-indigo-300">Fa√ßa o login</a></p>
        </div>

        <div id="user-screen" class="screen space-y-5">
            <header class="flex justify-between items-center">
                <div id="welcome-message" class="text-lg font-semibold"></div>
                <button onclick="handleSignOut()" class="py-2 px-4 text-sm font-semibold rounded-lg bg-red-600 hover:bg-red-700 transition-colors">Sair</button>
            </header>

            <!-- Ride Request View -->
            <div id="ride-request-container">
                <div class="bg-gray-800 p-4 rounded-xl space-y-3 mb-4">
                    <h3 class="text-xl font-bold">Carteira</h3>
                    <div class="flex justify-between items-center">
                        <p class="text-gray-300">Saldo atual:</p>
                        <p id="wallet-balance" class="text-2xl font-bold text-green-400">R$ 0,00</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="addCredits()" id="add-credits-btn" class="flex-1 py-3 font-semibold rounded-lg bg-indigo-600 hover:bg-indigo-700 transition-colors">
                            ADICIONAR CR√âDITOS
                        </button>
                         <button onclick="showTransactionHistory()" id="history-btn" class="py-3 px-4 font-semibold rounded-lg bg-gray-600 hover:bg-gray-500 transition-colors">
                            Hist√≥rico
                        </button>
                    </div>
                </div>

                <div class="bg-gray-800 p-4 rounded-xl space-y-4">
                    <h3 class="text-xl font-bold">Para onde vamos?</h3>
                    <form id="ride-request-form" class="space-y-3">
                        <input type="text" id="origin" placeholder="üìç Endere√ßo de Partida" class="w-full p-3 text-white rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:border-indigo-500" required>
                        <button type="button" onclick="useCurrentLocation()" class="w-full py-2 text-sm font-semibold rounded-lg bg-gray-600 hover:bg-gray-500 transition-colors">Usar Localiza√ß√£o Atual</button>
                        
                        <input type="text" id="destination" placeholder="üèÅ Endere√ßo de Destino" class="w-full p-3 text-white rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:border-indigo-500" required>
                        
                        <button type="button" onclick="calculatePriceEstimate()" id="estimate-btn" class="w-full py-3 font-semibold rounded-lg bg-blue-600 hover:bg-blue-700 transition-colors">
                            CALCULAR PRE√áO
                        </button>
                    </form>
                    
                    <div id="price-estimate-container" class="hidden space-y-2 pt-3 border-t border-gray-700">
                        <div class="flex justify-between items-center text-lg">
                            <span class="text-gray-300">Estimativa:</span>
                            <span id="estimated-price" class="font-bold text-2xl text-green-400"></span>
                        </div>
                         <div class="flex justify-between text-sm text-gray-400">
                            <span>Dist√¢ncia: <span id="estimated-distance"></span></span>
                            <span>Tempo: <span id="estimated-time"></span></span>
                        </div>
                    </div>
                     <button type="button" onclick="requestRide()" id="request-btn" disabled class="w-full py-3 font-semibold text-lg rounded-lg bg-green-600 hover:bg-green-700 transition-colors disabled:bg-gray-600 disabled:cursor-not-allowed">
                        üöó SOLICITAR
                    </button>
                </div>
            </div>

            <!-- Ride Status View -->
            <div id="ride-status-container" class="hidden space-y-4">
                <div class="bg-gray-800 p-4 rounded-xl space-y-4">
                    <h3 class="text-xl font-bold">Status da Viagem</h3>
                    <div id="status-timeline" class="space-y-3">
                        <!-- Timeline items will be injected here -->
                    </div>
                     <div class="pt-3 border-t border-gray-700 text-sm">
                        <p><strong>De:</strong> <span id="trip-origin">...</span></p>
                        <p><strong>Para:</strong> <span id="trip-destination">...</span></p>
                    </div>
                </div>

                <div id="driver-details-panel" class="bg-gray-800 p-4 rounded-xl space-y-3 transition-all transform opacity-0 -translate-y-4">
                    <h4 class="font-bold">Seu Motorista</h4>
                    <div>
                        <p id="driver-name" class="text-lg font-semibold">Procurando motorista...</p>
                        <p id="driver-car" class="text-gray-300">Aguarde um momento</p>
                        <p id="driver-plate" class="font-mono text-sm bg-gray-700 px-2 py-1 rounded-md inline-block"></p>
                    </div>
                    <div class="flex gap-2">
                        <button id="call-driver-btn" onclick="callDriver()" disabled class="flex-1 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600">Ligar</button>
                        <button id="message-driver-btn" onclick="messageDriver()" disabled class="flex-1 py-2 rounded-lg bg-green-600 hover:bg-green-700 disabled:bg-gray-600">Mensagem</button>
                    </div>
                </div>
                
                 <div class="flex gap-2">
                    <button id="cancel-ride-btn" onclick="cancelRide()" class="flex-1 py-2 rounded-lg bg-red-600 hover:bg-red-700">Cancelar</button>
                    <button id="help-btn" onclick="getHelp()" class="flex-1 py-2 rounded-lg bg-gray-600 hover:bg-gray-500">Ajuda</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="passageiro.js"></script>
</body>
</html>